<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8">
<center><b>
  <p id="chillyMessage" style="font-family:courier; font-size:1000%;"></p>
</b></center>
<script>
  const chillyMessage = document.getElementById("chillyMessage");
	const darkskyAPI = "7d24cfddd74cd54c9b270bf518edec3e";
	const chillyThreshold = 70;

	function httpGetAsync(theUrl, callback) {
			var xmlHttp = new XMLHttpRequest();
			xmlHttp.onreadystatechange = function() { 
					if (xmlHttp.readyState == 4 && xmlHttp.status == 200)
							callback(xmlHttp.responseText);
			}
			xmlHttp.open("GET", theUrl, true); // true for asynchronous 
			xmlHttp.send(null);
	}

	function getLocation() {
		if (navigator.geolocation) {
			navigator.geolocation.getCurrentPosition(getWeather);
		} else { 
			chillyMessage.innerHTML = "Whoops! We don't know where you are :(";
		}
	}

	function getWeather(position) {
		console.log(position);
		let latitude = position.coords.latitude;
		let longitude = position.coords.longitude;
		let url = "https://cors-anywhere.herokuapp.com/https://api.darksky.net/forecast/" + darkskyAPI + "/" + latitude + "," + longitude + "?exclude=minutely,hourly,daily,alerts,flags";
		httpGetAsync(url, showMessage);
	}

	function showMessage(weatherResponse) {
		weatherResponse = JSON.parse(weatherResponse);
		console.log(weatherResponse);
		let apparentTemperature = weatherResponse.currently.apparentTemperature;
		if (apparentTemperature < chillyThreshold) {
			chillyMessage.innerHTML = "CHILLY";
			document.body.style.background = "#85C1E9";
		} else {
			chillyMessage.innerHTML = "NOT CHILLY";
			document.body.style.background = "#F8C471";
		}
	}
	
	getLocation();
</script>
</head>
</html>                            